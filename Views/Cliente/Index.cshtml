@*
    NOTA: El modelo para esta vista (Index.cshtml) debe ser el mismo
    que el de ResultadosBusqueda.cshtml, es decir, 'VerPorLista'
*@
@model PROYECTOMOVIE.Models.VerPorLista

<!DOCTYPE html>
<html lang="es">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>WatchLenn</title>

    <link rel="stylesheet" href="~/lib/bootstrap/dist/css/bootstrap.min.css" />
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.2.0/css/all.min.css">
    <link rel="stylesheet" href="~/css/index.css" asp-append-version="true" />
    <link rel="stylesheet" href="~/PROYECTOMOVIE.styles.css" asp-append-version="true" />
</head>
<body>

    <header class="header">
        <div class="logo"><i class="fa-solid fa-film"></i>WatchLenn</div>
        <nav class="nav-links">
            <a href="/Cliente/Index" class="nav-active">Inicio</a>
            <a href="/Cliente/Pelis">Películas</a>
            <a href="/Cliente/Series">Series</a>
            <a href="#">Popular</a>
            <a href="/Lista/Index">Mis Listas</a>
        </nav>

        <div class="nav-actions">
            <a href="/Cliente/Gemini" class="btn-login">Crea tu historia</a>

            <div class="user-info">
                <partial name="_LoginPartial" />
            </div>

            <div class="avatar"><i class="fa-solid fa-user"></i></div>
        </div>
    </header>

    <main>
        <section class="hero-section">
            
            <div class="slider-container">

                <div class="hero-slide active">
                    <div class="hero-background">
                        <video 
                            poster="~/IMG/img pelis/avatar.jpeg" 
                            autoplay 
                            muted 
                            loop 
                            playsinline>
                            
                            <source src="~/Videos/avatar-3-trailer.mp4 " type="video/mp4">
                            Tu navegador no soporta el tag de video.
                        </video>
                    </div>
                    <div class="hero-overlay"></div>
                    <div class="hero-content container">
                        <h1 class="hero-title">AVATAR 3: Fire and Ash</h1>
                        <p class="hero-description">
                            Próximamente en 2024: Sumérgete en el mundo de Pandora una vez más con "Avatar 3: Fire and Ash", la esperada continuación de la saga épica de ciencia ficción dirigida por James Cameron.
                        </p>
                        <div class="hero-actions">
                            <button class="btn-icon-action"><i class="fa-solid fa-plus"></i></button>
                            <button class="btn-icon-action"><i class="fa-solid fa-info"></i></button>

                            <button class="btn-icon-action mute-toggle">
                                <i class="fa-solid fa-volume-xmark"></i>
                            </button>
                        </div>
                    </div>
                </div>

                <div class="hero-slide">
                    <div class="hero-background">
                        <img src="~/IMG/img-pelis/together.png" alt="Together">
                    </div>
                    <div class="hero-overlay"></div>
                    <div class="hero-content container">
                        <h1 class="hero-title">Together</h1>
                        <p class="hero-description">
                            Tras mudarse al campo en busca de una nueva vida, una pareja comienza a experimentar fenómenos sobrenaturales que no solo alteran su vínculo, sino también su percepción de la relación... y de sí mismos.
                        </p>
                        <div class="hero-actions">
                            <button class="btn-watch">
                                <i class="fa-solid fa-play"></i>
                                Ver en Amazon Prime
                            </button>
                            <button class="btn-icon-action"><i class="fa-solid fa-plus"></i></button>
                            <button class="btn-icon-action"><i class="fa-solid fa-info"></i></button>
                        </div>
                    </div>
                </div>

                <div class="hero-slide">
                    <div class="hero-background">
                        <img src="~/IMG/img-pelis/elio.jpg" alt="Elio">
                    </div>
                    <div class="hero-overlay"></div>
                    <div class="hero-content container">
                        <h1 class="hero-title">Elio</h1>
                        <p class="hero-description">
                            En esta aventura cósmica llena de diversión y acción, Elio, un fanático del espacio con una imaginación muy activa, es teletransportado a una organización interplanetaria con miembros de galaxias lejanas. Identificado erróneamente por el líder de la Tierra, Elio debe forjar lazos con formas de vida extraterrestre, evitar una crisis intergaláctica y descubrir quién es y cuál es su lugar.
                        </p>
                        <div class="hero-actions">
                            <button class="btn-watch">
                                <i class="fa-solid fa-play"></i>
                                Ver en Disney+
                            </button>
                            <button class="btn-icon-action"><i class="fa-solid fa-plus"></i></button>
                            <button class="btn-icon-action"><i class="fa-solid fa-info"></i></button>
                        </div>
                    </div>
                </div>

            </div> <button class="slider-nav prev"><i class="fa-solid fa-chevron-left"></i></button>
            <button class="slider-nav next"><i class="fa-solid fa-chevron-right"></i></button>
            
        </section>

        <section class="search-block-section">
            <div class="container">
                <h2>¿No sabes qué ver?</h2>
                <form asp-controller="Cliente" asp-action="Buscar" method="get" class="search-block-container">
            
                    <div class="search-input-wrapper">
                        <input type="text" 
                               name="terminoBusqueda" 
                               placeholder="Buscar por título..." 
                               class="search-block-input">
                        <i class="fa-solid fa-xmark search-clear-icon"></i>
                    </div>
                    
                    <div class="search-buttons-container">
                        
                        <button type="submit" 
                                asp-action="Buscar" 
                                class="btn-buscar">
                                Buscar
                        </button>
                        
                        <button type="submit" 
                                asp-action="Aleatorio" 
                                class="btn-aleatorio" 
                                formmethod="get"> Modo Aleatorio
                        </button>
                    </div>

                </form>
            </div>
        </section>


        <div class="content-area container">

           <section class="content-row">
                <h2 class="row-title">
                    <span>Películas</span>
                    @* Este enlace lleva a la página que muestra TODAS las películas *@
                    <a href="/Cliente/Pelis">Ver más <i class="fa-solid fa-angle-right"></i></a>
                </h2>
                <div class="posters-container">

                    @* Bucle para dibujar cada película del ViewModel *@
                    @foreach (var pelicula in Model.Peliculas)
                    {
                        @*
                           --- INICIO DE LA CORRECCIÓN ---
                           Ahora es UN solo <a> que envuelve un <div>
                        *@
                        <a asp-controller="Cliente"
                           asp-action="PeliculaDetalle"
                           asp-route-id="@pelicula.Id"
                           class="poster-link-wrapper">

                            @* Esto ahora es un DIV, no un <a> *@
                            <div class="poster-card">
                                <img src="@pelicula.Imagen_Peli" alt="@pelicula.Nombre_Peli">
                                <div class="poster-info">
                                    <div class="title">@pelicula.Nombre_Peli</div>
                                </div>
                            </div>
                        </a>
                        @* --- FIN DE LA CORRECCIÓN --- *@
                    }
                    
                    @* Si no hay películas, puedes mostrar un mensaje *@
                    @if (Model.Peliculas.Count == 0)
                    {
                        <p>No hay películas para mostrar en este momento.</p>
                    }
                    
                </div>
            </section>

            <section class="content-row">
                <h2 class="row-title">
                    <span>Series</span>
                    @* Este enlace lleva a la página que muestra TODAS las series *@
                    <a href="/Cliente/Series">Ver más <i class="fa-solid fa-angle-right"></i></a>
                </h2>
                 <div class="posters-container">

                    @* Bucle para dibujar cada serie del ViewModel *@
                    @foreach (var serie in Model.Series)
                    {
                        @*
                           --- INICIO DE LA CORRECCIÓN 2 ---
                           Actualizado para usar asp-action="SerieDetalle"
                        *@
                        <a asp-controller="Cliente"
                           asp-action="SerieDetalle"
                           asp-route-id="@serie.Id"
                           class="poster-link-wrapper">
                        
                            <div class="poster-card">
                                <img src="@serie.Imagen_Serie" alt="@serie.Nombre_Serie">
                                <div class="poster-info">
                                    <div class="title">@serie.Nombre_Serie</div>
                                </div>
                            </div>
                        </a>
                        @* --- FIN DE LA CORRECCIÓN 2 --- *@
                    }

                    @* Si no hay series, puedes mostrar un mensaje *@
                    @* LÍNEA CORREGIDA (debe chequear Model.Series, no Model.Peliculas) *@
                    @if (Model.Series.Count == 0)
                    {
                        <p>No hay series para mostrar en este momento.</p>
                    }

                </div>
            </section>
        </div>
    </main>

    <footer class="border-top footer text-muted">
        <div class="container">
            &copy; 2025 - PROYECTOMOVIE
        </div>
    </footer>

@* El JavaScript se mantiene igual *@
<script>
    document.addEventListener('DOMContentLoaded', function () {
        // --- CÓDIGO DEL SLIDER DE HÉROE ---
        const slides = document.querySelectorAll('.hero-slide');
        const nextButton = document.querySelector('.slider-nav.next');
        const prevButton = document.querySelector('.slider-nav.prev');
        let currentSlide = 0;
        let slideTimer;

        function showSlide(index) {
            // 1. Limpiar temporizador de imagen anterior
            clearTimeout(slideTimer);

            // 2. Limpiar video y botón de mute anterior
            const oldActiveSlide = document.querySelector('.hero-slide.active');
            if (oldActiveSlide) {
                const oldVideo = oldActiveSlide.querySelector('video');
                const oldMuteButton = oldActiveSlide.querySelector('.mute-toggle');
                if (oldVideo) {
                    oldVideo.pause();
                    oldVideo.onended = null;
                    if (oldMuteButton) oldMuteButton.onclick = null; // Limpia el listener
                }
            }

            // 3. Ocultar todos los slides
            slides.forEach(slide => {
                slide.classList.remove('active');
            });
            
            // 4. Calcular el nuevo índice
            if (index >= slides.length) currentSlide = 0;
            else if (index < 0) currentSlide = slides.length - 1;
            else currentSlide = index;
            
            // 5. Mostrar el slide actual
            const newActiveSlide = slides[currentSlide];
            newActiveSlide.classList.add('active');

            // 6. Revisar el contenido del NUEVO slide
            const newVideo = newActiveSlide.querySelector('video');
            const muteButton = newActiveSlide.querySelector('.mute-toggle'); // Busca el botón
            const muteIcon = muteButton ? muteButton.querySelector('i') : null; // Verificación

            if (newVideo) {
                // --- SI ES VIDEO ---
                
                if (muteButton) { // Solo si existe el botón
                    // A. Mostrar y configurar el botón de mute
                    muteButton.style.display = 'flex'; // Muestra el botón
                    
                    // Asegurarse que el video SIEMPRE empiece muteado
                    newVideo.muted = true;
                    if (muteIcon) muteIcon.className = 'fa-solid fa-volume-xmark'; // Icono de silencio

                    // B. Asignar la acción de clic al botón
                    muteButton.onclick = () => {
                        if (newVideo.muted) {
                            newVideo.muted = false;
                            if (muteIcon) muteIcon.className = 'fa-solid fa-volume-high'; // Icono de sonido
                        } else {
                            newVideo.muted = true;
                            if (muteIcon) muteIcon.className = 'fa-solid fa-volume-xmark'; // Icono de silencio
                        }
                    };
                }

                // C. Configurar el video
                newVideo.currentTime = 0; 
                newVideo.play(); 
                
                // D. Escuchar cuándo termina
                newVideo.onended = () => {
                    showSlide(currentSlide + 1);
                };

            } else {
                // --- SI ES IMAGEN ---
                
                // Ocultar el botón de mute (si existe)
                if (muteButton) muteButton.style.display = 'none'; 
                
                // Iniciar el temporizador normal de 7 segundos
                slideTimer = setTimeout(() => {
                    showSlide(currentSlide + 1);
                }, 7000);
            }
        }

        // 7. Eventos de los botones de navegación
        if (nextButton && prevButton) {
            nextButton.addEventListener('click', () => {
                showSlide(currentSlide + 1);
            });
            prevButton.addEventListener('click', () => {
                showSlide(currentSlide - 1);
            });
        }

        // 8. Iniciar el slider (solo si hay slides)
        if (slides.length > 0) {
            showSlide(currentSlide);
        }


        // ----------------------------------------------------------------------------------
        // --- NUEVO CÓDIGO PARA BORRAR LA BARRA DE BÚSQUEDA ---
        // ----------------------------------------------------------------------------------

        const inputField = document.querySelector('.search-block-input');
        const clearIcon = document.querySelector('.search-clear-icon');

        if (inputField && clearIcon) {
            
            // Función para borrar el campo
            function clearSearchInput() {
                inputField.value = ''; // Establece el valor del input a vacío
                inputField.focus(); // Vuelve a enfocar el input
                toggleClearIcon(); // Oculta la 'x'
            }

            // Función para mostrar/ocultar la 'x' dinámicamente
            function toggleClearIcon() {
                // Usamos 'block' o 'inline-block' para mostrar, y 'none' para ocultar
                // Asumo que el ícono está diseñado para aparecer a la derecha del input.
                if (inputField.value.length > 0) {
                    clearIcon.style.display = 'block'; 
                } else {
                    clearIcon.style.display = 'none';
                }
            }

            // 1. Agregar el Listener de evento al ícono para borrar
            clearIcon.addEventListener('click', clearSearchInput);

            // 2. Escuchar cada vez que se teclea algo en el input (para mostrar/ocultar la 'x')
            inputField.addEventListener('input', toggleClearIcon);
            
            // 3. Inicializar (ocultar la 'x' si no hay texto al cargar la página)
            toggleClearIcon(); 
        }
        
    });
</script>
</body>
</html>